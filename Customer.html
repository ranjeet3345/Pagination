<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>

  <div class="container table-container">
    <h2>üìã Customer List</h2>

    <div class="mb-3 text-center">
      <label class="form-label fw-bold">Sort By:</label>
      <select id="sortSelect" class="form-select d-inline-block w-auto ms-2">
        <option value="">-- None --</option>
        <option value="cname">Name (A-Z)</option>
        <option value="-cname">Name (Z-A)</option>
        <option value="cemail">Email (A-Z)</option>
        <option value="-cemail">Email (Z-A)</option>
      </select>
    </div>

    <table class="table table-bordered table-hover text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Customer ID</th>
        </tr>
      </thead>
      <tbody id="customer-body">
        <!-- Customer rows will be inserted here -->
      </tbody>
    </table>

    <div class="pagination-buttons">
      <button class="btn btn-outline-primary" id="prev">‚¨ÖÔ∏è Previous</button>
      <button class="btn btn-outline-primary" id="next">Next ‚û°Ô∏è</button>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let currentSort = '';
    const BASE_URL = 'http://127.0.0.1:8000/customerapi/';

    function loadCustomers() {
      const url = `${BASE_URL}?page=${currentPage}&sort_by=${currentSort}`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          const tbody = document.getElementById('customer-body');
          tbody.innerHTML = '';

          data.results.forEach(customer => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${customer.id}</td>
              <td>${customer.cname}</td>
              <td>${customer.cemail}</td>
              <td>${customer.cid}</td>
            `;
            tbody.appendChild(row);
          });

          document.getElementById('prev').disabled = !data.previous;
          document.getElementById('next').disabled = !data.next;
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    document.getElementById('sortSelect').addEventListener('change', (e) => {
      currentSort = e.target.value;
      currentPage = 1;
      loadCustomers();
    });

    document.getElementById('prev').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        loadCustomers();
      }
    });

    document.getElementById('next').addEventListener('click', () => {
      currentPage++;
      loadCustomers();
    });

    loadCustomers();
  </script>

</body>
</html>
